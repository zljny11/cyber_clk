<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25:00 | SYSTEM READY</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* === CYBERPUNK 2077 VISUAL IDENTITY === */
        :root {
            --cp-yellow: #fcee0a;
            --cp-blue: #00f0ff;
            --cp-red: #ff003c;
            --cp-green: #00ff9f;
            --font-main: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif;
            color: var(--cp-yellow);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* === ËßÜËßâÂ±Ç === */
        #bg-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-size: cover;
            background-position: center;
            background-image: url('101454734.jpg');
            filter: contrast(1.1) brightness(0.6);
            transition: background-image 0.5s ease;
        }

        #scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.3) 50%, rgba(0, 0, 0, 0.3));
            background-size: 100% 4px;
            pointer-events: none;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            mix-blend-mode: screen;
        }

        /* === ‰∏ªÈù¢Êùø UI === */
        .cyber-panel {
            position: relative;
            z-index: 10;
            width: 400px;
            padding: 40px;
            background: rgba(5, 5, 5, 0.6);
            clip-path: polygon(0 0, 100% 0, 100% 90%, 90% 100%, 0 100%);
            border-left: 4px solid var(--cp-yellow);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }

        .top-nav {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--cp-yellow);
            color: var(--cp-yellow);
            padding: 5px 10px;
            cursor: pointer;
            font-family: var(--font-main);
            font-weight: bold;
            font-size: 12px;
            transition: 0.2s;
            letter-spacing: 1px;
            user-select: none;
        }

        .nav-btn:hover,
        .nav-btn.active-btn {
            background: var(--cp-yellow);
            color: black;
            box-shadow: 0 0 10px var(--cp-yellow);
        }

        .timer-wrapper {
            text-align: center;
            margin: 10px 0 20px 0;
        }

        .timer-display {
            font-size: 80px;
            font-weight: 900;
            color: var(--cp-blue);
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.5);
            font-family: 'Arial Black', sans-serif;
            letter-spacing: -2px;
            line-height: 1;
        }

        .status-badge {
            display: inline-block;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--cp-blue);
            color: var(--cp-blue);
            padding: 4px 12px;
            font-size: 12px;
            letter-spacing: 2px;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: #222;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: var(--cp-yellow);
            box-shadow: 0 0 10px var(--cp-yellow);
            transition: width 1s linear;
        }

        .cyber-input {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-bottom: 2px solid #555;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-family: var(--font-main);
            outline: none;
            margin-bottom: 25px;
            box-sizing: border-box;
            transition: 0.3s;
        }

        .cyber-input:focus {
            background: rgba(0, 240, 255, 0.1);
            border-color: var(--cp-blue);
        }

        .glitch-btn {
            width: 100%;
            padding: 20px;
            background: var(--cp-yellow);
            color: black;
            border: none;
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            transition: 0.2s;
            letter-spacing: 2px;
            font-family: 'Arial Black', sans-serif;
        }

        .glitch-btn:hover {
            background: #fff;
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 var(--cp-blue);
        }

        .glitch-btn:disabled {
            background: #555;
            color: #888;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .pause-btn {
            background: transparent;
            border: 1px dashed #666;
            color: #888;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
            transition: 0.3s;
        }

        .pause-btn:hover {
            border-color: var(--cp-yellow);
            color: var(--cp-yellow);
        }

        /* === ‰æßËæπÊÇ¨ÊµÆÈù¢Êùø === */
        .slide-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            bottom: 20px;
            width: 340px;
            background: rgba(10, 10, 12, 0.95);
            z-index: 50;
            padding: 25px;
            box-sizing: border-box;
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1);
            border: 1px solid #333;
            border-right: 4px solid var(--cp-blue);
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
        }

        .slide-panel.active {
            transform: translateX(0);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--cp-blue);
            letter-spacing: 1px;
        }

        .stats-section {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .stats-section::-webkit-scrollbar {
            width: 4px;
        }

        .stats-section::-webkit-scrollbar-thumb {
            background: #333;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #222;
        }

        canvas#trendChart {
            width: 100%;
            height: 100px;
            display: block;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .ach-badge {
            aspect-ratio: 1;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #333;
            cursor: pointer;
            position: relative;
            transition: 0.3s;
            background: #000;
        }

        .ach-badge.unlocked {
            border-color: var(--cp-green);
            color: var(--cp-green);
            box-shadow: 0 0 5px var(--cp-green);
            text-shadow: 0 0 5px var(--cp-green);
        }

        #ach-desc {
            margin-top: 10px;
            min-height: 20px;
            font-size: 12px;
            color: var(--cp-blue);
            text-align: center;
            border-top: 1px dashed #333;
            padding-top: 8px;
            font-family: var(--font-main);
        }

        .purge-btn {
            background: rgba(255, 0, 60, 0.2);
            border: 1px solid var(--cp-red);
            color: var(--cp-red);
            font-size: 10px;
            padding: 4px 8px;
            cursor: pointer;
            font-family: var(--font-main);
            transition: 0.2s;
        }

        .purge-btn:hover {
            background: var(--cp-red);
            color: black;
        }

        /* === ÂºπÁ™óÈÄöÁî® === */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-box {
            width: 400px;
            background: #080808;
            border: 1px solid var(--cp-red);
            padding: 30px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 0, 60, 0.2);
            position: relative;
        }

        .modal-box.rating-mode {
            border-color: var(--cp-yellow);
            box-shadow: 0 0 30px rgba(252, 238, 10, 0.2);
        }

        .modal-box::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            width: 15px;
            height: 15px;
            border-top: 2px solid currentColor;
            border-left: 2px solid currentColor;
        }

        .modal-box::after {
            content: '';
            position: absolute;
            bottom: -1px;
            right: -1px;
            width: 15px;
            height: 15px;
            border-bottom: 2px solid currentColor;
            border-right: 2px solid currentColor;
        }

        textarea.pause-reason {
            width: 100%;
            height: 80px;
            background: #111;
            border: 1px solid #333;
            color: white;
            padding: 10px;
            margin: 15px 0;
            font-family: var(--font-main);
            resize: none;
            box-sizing: border-box;
        }

        .stars-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .star-btn {
            font-size: 32px;
            cursor: pointer;
            color: #333;
            transition: 0.2s;
            user-select: none;
        }

        .star-btn.active {
            color: var(--cp-yellow);
            text-shadow: 0 0 15px var(--cp-yellow);
            transform: scale(1.1);
        }

        #file-inputs {
            display: none;
        }

        /* === Êñ∞Â¢ûÔºöÁîµÂè∞Ê†∑Âºè === */
        .station-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 25px;
        }

        .station-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            color: #666;
            padding: 15px 10px;
            cursor: pointer;
            font-family: var(--font-main);
            text-transform: uppercase;
            transition: 0.3s;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .station-btn:hover {
            border-color: var(--cp-blue);
            color: var(--cp-blue);
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
        }

        .station-btn.active-station {
            background: var(--cp-yellow);
            color: black;
            border-color: var(--cp-yellow);
            box-shadow: 0 0 15px var(--cp-yellow);
            font-weight: bold;
        }

        /* ËµõÂçöÊúãÂÖãÈ£éÊ†ºÁöÑÊªëÂä®Êù° */
        .volume-control label {
            display: block;
            color: var(--cp-blue);
            font-size: 10px;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .cyber-range {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: #333;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        .cyber-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: var(--cp-red);
            cursor: pointer;
            border: 2px solid black;
        }

        .cyber-range:hover {
            opacity: 1;
        }

        /* === Êñ∞Â¢ûÔºöÂ£ÅÁ∫∏Èù¢ÊùøÊ†∑Âºè === */
        .bg-selector-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            /* Â¶ÇÊûúÂõæÁâáÂ§™Â§öÔºåÂÖÅËÆ∏ÊªöÂä® */
        }

        .bg-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            /* ‰∏§ÂàóÊòæÁ§∫ */
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #333;
            margin-bottom: 20px;
        }

        .bg-thumb {
            aspect-ratio: 16 / 9;
            /* Âº∫Âà∂ÂÆΩÂ±èÊØî‰æã‰Ωú‰∏∫Áº©Áï•Âõæ */
            background-size: cover;
            background-position: center;
            border: 2px solid #333;
            cursor: pointer;
            transition: 0.3s all ease;
            opacity: 0.6;
            filter: grayscale(0.5);
            /* ÈªòËÆ§Á®çÂæÆÁÅ∞‰∏ÄÁÇπ */
        }

        .bg-thumb:hover {
            opacity: 1;
            filter: grayscale(0);
            border-color: var(--cp-blue);
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.3);
        }

        /* ÈÄâ‰∏≠Áä∂ÊÄÅ */
        .bg-thumb.active-bg {
            opacity: 1;
            filter: grayscale(0);
            border-color: var(--cp-yellow);
            box-shadow: 0 0 15px var(--cp-yellow);
            transform: scale(1.02);
            /* ÈÄâ‰∏≠Êó∂Á®çÂæÆÊîæÂ§ß‰∏ÄÁÇπÁÇπ */
        }

        .custom-upload-section {
            margin-top: auto;
            /* ÊääÂÆÉÊå§Âà∞ÊúÄ‰∏ãÈù¢ */
            padding-top: 20px;
        }
    </style>
</head>

<body>

    <div id="bg-layer"></div>
    <div id="scanlines"></div>
    <div id="canvas-container"></div>

    <div class="cyber-panel" id="main-panel">
        <div class="top-nav">
            <button class="nav-btn" onclick="document.getElementById('music-input').click()">üéµ BGM</button>
            <button class="nav-btn" id="btn-bg" onclick="togglePanel('bg')">üñºÔ∏è BG</button>
            <button class="nav-btn" id="btn-sys" onclick="togglePanel('settings')">‚öôÔ∏è SYS</button>
            <button class="nav-btn" id="btn-stats" onclick="togglePanel('stats');">üìä DAT</button>
            <button class="nav-btn" id="btn-radio" onclick="togglePanel('radio')">üì° RADIO</button>
        </div>

        <div style="display:none;" id="file-inputs">
            <input type="file" id="bg-input" accept="image/*" onchange="loadBackground(this)">
            <input type="file" id="music-input" accept="audio/*" onchange="loadMusic(this)">
        </div>

        <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
            <div class="timer-wrapper">
                <div class="timer-display" id="timer">25:00</div>
                <div class="status-badge" id="status-badge">READY TO BREACH</div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>

            <input type="text" class="cyber-input" id="task-input" placeholder=">> ËÆæÂÆöÂÖ•‰æµÁõÆÊ†á..." autocomplete="off">

            <button class="glitch-btn" id="action-btn" onclick="handleMainAction()">ÂºÄÂßãÂÖ•‰æµ...</button>
            <button class="pause-btn" id="pause-btn" onclick="requestPause()" style="display:none;">// Áî≥ËØ∑ÊåÇËµ∑</button>
        </div>
    </div>

    <div class="slide-panel" id="stats-panel">
        <div class="panel-header">
            <span class="panel-title">MISSION ARCHIVE</span>
            <button class="purge-btn" onclick="purgeData()">‚ö†Ô∏è PURGE DATABASE</button>
        </div>

        <div class="stats-section">
            <div class="stats-card">
                <div style="font-size: 11px; color: #888; margin-bottom: 5px;">ACHIEVEMENTS (ÊàêÂ∞±ÂçèËÆÆ)</div>
                <div class="achievement-grid" id="ach-container"></div>
                <div id="ach-desc">HOVER ICON FOR DETAILS</div>
            </div>

            <div class="stats-card">
                <div style="font-size: 11px; color: #888; margin-bottom: 5px;">‰∏ìÊ≥®Ë¥®ÈáèË∂ãÂäø (ÊúÄËøë10Ê¨°)</div>
                <canvas id="trendChart"></canvas>
            </div>

            <div class="stats-card">
                <div style="font-size: 11px; color: #888; margin-bottom: 5px;">‰ªäÊó•Â∑≤ÂÖ•‰æµÊó∂Èïø</div>
                <div style="font-size: 24px; font-weight:bold; color:white;" id="today-total">0m</div>
            </div>

            <div style="font-size:12px; color:var(--cp-yellow); margin:10px 0;">ËØ¶ÁªÜÊó•Âøó:</div>
            <div id="task-list" style="font-size:12px; color:#ccc;"></div>
        </div>
    </div>

    <div class="slide-panel" id="settings-panel">
        <div class="panel-header">
            <span class="panel-title">SYSTEM CONFIG</span>
        </div>
        <div style="margin-top:20px;">
            <label style="color:var(--cp-blue); font-size:12px; display:block; margin-bottom:10px;">ÂÖ•‰æµÊó∂Èïø (MIN)</label>
            <input type="number" class="cyber-input" id="cfg-work" value="25">
            <label style="color:var(--cp-blue); font-size:12px; display:block; margin-bottom:10px;">ÂÜ∑Âç¥Êó∂Èïø (MIN)</label>
            <input type="number" class="cyber-input" id="cfg-break" value="5">
            <button class="glitch-btn" onclick="saveSettings()" style="font-size:16px; margin-top:20px;">‰øùÂ≠òÈÖçÁΩÆ</button>
        </div>
    </div>

    <div class="modal-overlay" id="pause-modal">
        <div class="modal-box">
            <h2 style="color:var(--cp-red); margin-top:0;">‚ö†Ô∏è ÊöÇÂÅúË≠¶Âëä</h2>
            <p style="color:#aaa; font-size:13px; text-align:left;">Ê†πÊçÆÂçèËÆÆÔºåÊöÇÂÅúÈúÄË¶ÅÊ≠£ÂΩìÁêÜÁî±ÔºàËá≥Â∞ë10Â≠óÔºâ„ÄÇ<br>ÊöÇÂÅúË∂ÖËøá <span
                    style="color:white;">10ÂàÜÈíü</span> Â∞ÜÂØºËá¥Á•ûÁªèËøûÊé•‰∏≠Êñ≠Ôºà‰ªªÂä°Â§±Ë¥•Ôºâ„ÄÇ</p>
            <textarea class="pause-reason" id="pause-reason-input" placeholder="ËæìÂÖ•ÁêÜÁî±..."></textarea>
            <div style="display:flex; gap:10px;">
                <button class="glitch-btn" onclick="cancelPauseRequest()"
                    style="background:#333; font-size:14px; color:white;">ÂèñÊ∂à</button>
                <button class="glitch-btn" id="confirm-pause-btn" onclick="confirmPause()"
                    style="background:var(--cp-red); font-size:14px;">Á°ÆËÆ§ÊåÇËµ∑</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="rating-modal">
        <div class="modal-box rating-mode">
            <h2 style="color:var(--cp-yellow); margin-top:0;">ÂÖ•‰æµÂÆåÊàê</h2>
            <p style="color:#aaa; font-size:14px;">Á•ûÁªèÂêåÊ≠•ÁéáËØÑ‰º∞</p>
            <div class="stars-container">
                <span class="star-btn" onclick="setRating(1)" data-v="1">‚òÖ</span>
                <span class="star-btn" onclick="setRating(2)" data-v="2">‚òÖ</span>
                <span class="star-btn" onclick="setRating(3)" data-v="3">‚òÖ</span>
                <span class="star-btn" onclick="setRating(4)" data-v="4">‚òÖ</span>
                <span class="star-btn" onclick="setRating(5)" data-v="5">‚òÖ</span>
            </div>
            <button class="glitch-btn" id="submit-rating-btn" onclick="submitRating()"
                style="font-size:16px;">‰∏ä‰º†Êï∞ÊçÆ</button>
        </div>
    </div>

    <div class="slide-panel" id="radio-panel">
        <div class="panel-header">
            <span class="panel-title">NEURAL FREQUENCY</span>
            <div style="font-size:10px; color:var(--cp-green)" id="radio-status">OFFLINE</div>
        </div>

        <div class="radio-interface">
            <div class="station-grid">
                <button class="station-btn" onclick="switchStation(0)">üåßÔ∏è Rain</button>
                <button class="station-btn" onclick="switchStation(1)">üéπ Jazz</button>
                <button class="station-btn" onclick="switchStation(2)">üåÉ Synth</button>
                <button class="station-btn" onclick="switchStation(3)">üéß HipHop</button>
                <button class="station-btn" onclick="switchStation(4)">üåä White</button>
            </div>

            <div class="volume-control">
                <label>GAIN LEVEL</label>
                <input type="range" class="cyber-range" min="0" max="100" value="50"
                    oninput="setRadioVolume(this.value)">
            </div>

            <button class="glitch-btn" id="cut-signal-btn" onclick="stopRadio()"
                style="margin-top:20px; font-size:14px; background:#333; color:#888;">// CUT SIGNAL</button>
        </div>
    </div>

    <div class="slide-panel" id="bg-panel">
        <div class="panel-header">
            <span class="panel-title">VISUAL DATABASE</span>
        </div>

        <div class="bg-selector-container">
            <div class="bg-grid">
                <button class="bg-thumb active-bg" style="background-image: url('101454734.jpg')"
                    data-src="101454734.jpg" onclick="switchBackground(this)">
                </button>

                <button class="bg-thumb" style="background-image: url('bg/cp1.jpg')" data-src="bg/cp1.jpg"
                    onclick="switchBackground(this)">
                </button>

                <button class="bg-thumb" style="background-image: url('bg/cp2.jpg')" data-src="bg/cp2.jpg"
                    onclick="switchBackground(this)">
                </button>

                <button class="bg-thumb" style="background-image: url('bg/cp3.png')" data-src="bg/cp3.png"
                    onclick="switchBackground(this)">
                </button>

                <button class="bg-thumb" style="background-image: url('bg/cp4.jpg')" data-src="bg/cp4.jpg"
                    onclick="switchBackground(this)">
                </button>
            </div>

            <div class="custom-upload-section">
                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Wait a minute, I'll use my own
                </div>
                <button class="glitch-btn" onclick="document.getElementById('bg-input').click()"
                    style="font-size:14px; padding: 15px;">
                    // UPLOAD LOCAL FILE
                </button>
            </div>
        </div>
    </div>
    </div>

    <audio id="bgm-player" loop></audio>

    <script>
        // ==========================================
        // 0. WORKER & DATA DEFINITION
        // ==========================================
        const workerScript = `
        self.onmessage = function(e) {
            if (e.data === 'start') {
                if (self.timer) clearInterval(self.timer);
                self.timer = setInterval(() => {
                    self.postMessage('tick');
                }, 1000);
            } else if (e.data === 'stop') {
                if (self.timer) clearInterval(self.timer);
            }
        };
    `;
        const workerBlob = new Blob([workerScript], { type: 'application/javascript' });
        const timerWorker = new Worker(URL.createObjectURL(workerBlob));

        const ACH_DEFS = {
            'rookie': { icon: 'üê£', title: 'ÂàùÂá∫ËåÖÂéï: Á¥ØËÆ°‰∏ìÊ≥®1Â∞èÊó∂' },
            'thinker': { icon: 'üß†', title: 'ËµõÂçöÊÄùÊÉ≥ÂÆ∂: Á¥ØËÆ°‰∏ìÊ≥®15Â∞èÊó∂' },
            'resilient': { icon: 'üõ°Ô∏è', title: 'ÁôæËõ∞‰∏çÊå†: ‰∏≠Êñ≠Âêé‰ªçÂÆåÊàê‰ªªÂä°' },
            'durable': { icon: 'üîã', title: 'ÊåÅ‰πÖËøòÂæóÁúã‰Ω†: ËøûÁª≠7Â§©‰ΩøÁî®' },
            'highroller': { icon: 'üíé', title: 'È´òÔºàÂàÜÔºâÁé©ÔºàÂÆ∂Ôºâ: ÊúÄËøë10Ê¨°ÂùáÂàÜ>4' }
        };

        let appState = {
            active: false,
            paused: false,
            mode: 'work',
            timeLeft: 25 * 60,
            endTime: 0,
            pauseEndTime: 0,
            totalTime: 25 * 60,
            currentTask: '',
            hasPausedInSession: false,
            tempRating: 3
        };

        let config = { work: 25, break: 5 };

        // ==========================================
        // 1. INITIALIZATION & EVENTS
        // ==========================================
        window.onload = () => {
            initThree();
            renderAchievements();

            document.addEventListener('click', (e) => {
                const isClickInsidePanel = e.target.closest('.slide-panel');
                const isClickButton = e.target.closest('.nav-btn');
                const isPurgeButton = e.target.closest('.purge-btn');
                if (!isClickInsidePanel && !isClickButton && !isPurgeButton) {
                    closeAllPanels();
                }
            });

            const savedCfg = localStorage.getItem('cp_config');
            if (savedCfg) config = JSON.parse(savedCfg);
            document.getElementById('cfg-work').value = config.work;
            document.getElementById('cfg-break').value = config.break;

            // ÂàùÂßãÂåñÊó∂Á´ãÂç≥Êõ¥Êñ∞‰∏Ä‰∏ãÊ†áÈ¢ò
            updateTimerDisplay();

            timerWorker.onmessage = (e) => {
                if (e.data === 'tick') {
                    if (appState.active && !appState.paused) {
                        tick();
                    } else if (appState.paused) {
                        pauseTick();
                    }
                }
            };
        };

        // ==========================================
        // 2. CORE TIMER LOGIC (WORKER DRIVEN)
        // ==========================================
        function handleMainAction() {
            if (appState.active) {
                if (confirm('Ë≠¶ÂëäÔºöÂº∫Ë°å‰∏≠Ê≠¢ËøûÊé•‰ºöÂØºËá¥Êï∞ÊçÆ‰∏¢Â§±Ôºà‰ªªÂä°Â§±Ë¥•Ôºâ„ÄÇÁ°ÆËÆ§Ôºü')) {
                    failTask('‰∏ªÂä®ÊîæÂºÉ');
                }
            } else {
                if (appState.mode === 'work' && !document.getElementById('task-input').value.trim()) {
                    alert('ÈîôËØØÔºöÂøÖÈ°ªÊåáÂÆö‰ªªÂä°ÁõÆÊ†á');
                    return;
                }
                startTimer();
            }
        }

        function startTimer() {
            appState.active = true;
            appState.paused = false;
            appState.hasPausedInSession = false;
            appState.currentTask = document.getElementById('task-input').value;
            appState.totalTime = (appState.mode === 'work' ? config.work : config.break) * 60;

            appState.endTime = Date.now() + appState.totalTime * 1000;
            appState.timeLeft = appState.totalTime;

            document.getElementById('task-input').disabled = true;
            document.getElementById('action-btn').innerText = "‰∏≠Ê≠¢ÂÖ•‰æµ";
            document.getElementById('action-btn').style.background = "var(--cp-red)";
            document.getElementById('pause-btn').style.display = appState.mode === 'work' ? 'block' : 'none';

            const badge = document.getElementById('status-badge');
            badge.innerText = appState.mode === 'work' ? "BREACH IN PROGRESS" : "SYSTEM REBOOTING";
            badge.style.color = appState.mode === 'work' ? "var(--cp-red)" : "var(--cp-blue)";

            updateTimerDisplay(); // Á´ãÂç≥Êõ¥Êñ∞Ê†áÈ¢ò

            const bgm = document.getElementById('bgm-player');
            if (bgm.src) bgm.play().catch(() => { });

            timerWorker.postMessage('start');
        }

        function tick() {
            const now = Date.now();
            const remaining = Math.round((appState.endTime - now) / 1000);

            appState.timeLeft = remaining;

            if (appState.timeLeft <= 0) {
                appState.timeLeft = 0;
                updateTimerDisplay();
                updateProgressBar();
                completeSession();
            } else {
                updateTimerDisplay();
                updateProgressBar();
            }
        }

        // ==========================================
        // 3. PAUSE PROTOCOL
        // ==========================================
        function requestPause() {
            document.getElementById('pause-modal').style.display = 'flex';
            document.getElementById('pause-reason-input').value = '';
            document.getElementById('confirm-pause-btn').disabled = false;
        }

        function cancelPauseRequest() {
            document.getElementById('pause-modal').style.display = 'none';
        }

        function confirmPause() {
            const btn = document.getElementById('confirm-pause-btn');
            btn.disabled = true;

            const reason = document.getElementById('pause-reason-input').value.trim();
            if (reason.length < 10) {
                alert('ÁêÜÁî±‰∏çÂ§üÂÖÖÂàÜ (Ëá≥Â∞ë10Â≠ó)');
                btn.disabled = false;
                return;
            }

            document.getElementById('pause-modal').style.display = 'none';
            appState.paused = true;
            appState.hasPausedInSession = true;

            appState.pauseEndTime = Date.now() + 600 * 1000;

            document.getElementById('status-badge').innerText = "CONNECTION SUSPENDED";
            document.getElementById('pause-btn').innerText = "ÊÅ¢Â§çËøûÊé•";
            document.getElementById('pause-btn').onclick = resumeTimer;

            document.getElementById('bgm-player').pause();
            // Pause tick managed by worker
        }

        function pauseTick() {
            const pNow = Date.now();
            const pRem = Math.round((appState.pauseEndTime - pNow) / 1000);

            // ÊöÇÂÅúÊó∂‰πüÊääÊó∂Èó¥ÊîæÂâçÈù¢
            document.title = `${formatTime(pRem)} | ‚ö†Ô∏è PAUSED`;

            if (pRem <= 0) {
                failTask('ÊöÇÂÅúË∂ÖÊó∂ (Á•ûÁªèËøûÊé•Êñ≠ÂºÄ)');
            }
        }

        function resumeTimer() {
            appState.paused = false;
            appState.endTime = Date.now() + appState.timeLeft * 1000;

            document.getElementById('status-badge').innerText = "BREACH IN PROGRESS";
            document.getElementById('pause-btn').innerText = "// Áî≥ËØ∑ÊåÇËµ∑";
            document.getElementById('pause-btn').onclick = requestPause;

            const bgm = document.getElementById('bgm-player');
            if (bgm.src) bgm.play().catch(() => { });

            updateTimerDisplay();
        }

        // ==========================================
        // 4. COMPLETION & FAIL
        // ==========================================
        function completeSession() {
            timerWorker.postMessage('stop');
            playBeep();

            if (appState.mode === 'work') {
                document.getElementById('rating-modal').style.display = 'flex';
                document.getElementById('submit-rating-btn').disabled = false;
                setRating(3);
            } else {
                alert("Á≥ªÁªüÂÜ∑Âç¥ÂÆåÊØï„ÄÇ");
                appState.mode = 'work';
                resetUI();
            }
        }

        function failTask(reason) {
            timerWorker.postMessage('stop');
            saveRecord(appState.currentTask, (appState.totalTime - appState.timeLeft) / 60, 0, false, reason);
            alert(`‰ªªÂä°Â§±Ë¥•: ${reason}`);
            resetUI();
        }

        function submitRating() {
            const btn = document.getElementById('submit-rating-btn');
            btn.disabled = true;

            document.getElementById('rating-modal').style.display = 'none';
            saveRecord(appState.currentTask, config.work, appState.tempRating, true);

            checkHealth();

            if (confirm('Êï∞ÊçÆ‰∏ä‰º†ÂÆåÊØï„ÄÇËøõÂÖ•ÂÜ∑Âç¥Ê®°ÂºèÔºü')) {
                appState.mode = 'break';
                startTimer();
            } else {
                resetUI();
            }
        }

        function resetUI() {
            appState.active = false;
            appState.paused = false;
            appState.hasPausedInSession = false;
            timerWorker.postMessage('stop');

            document.getElementById('task-input').disabled = false;
            document.getElementById('action-btn').innerText = "ÂºÄÂßãÂÖ•‰æµ";
            document.getElementById('action-btn').style.background = "var(--cp-yellow)";
            document.getElementById('pause-btn').style.display = 'none';
            document.getElementById('status-badge').innerText = "READY TO BREACH";
            document.getElementById('status-badge').style.color = "var(--cp-blue)";

            document.getElementById('progress-bar').style.width = '0%';

            // ÈáçÁΩÆÊó∂Èó¥ÊòæÁ§∫Âπ∂Êõ¥Êñ∞Ê†áÈ¢ò
            appState.timeLeft = (appState.mode === 'work' ? config.work : config.break) * 60;
            updateTimerDisplay();

            document.getElementById('bgm-player').pause();
        }

        // ==========================================
        // 5. DATA, ACHIEVEMENTS & PURGE
        // ==========================================
        function purgeData() {
            if (confirm("‚ö†Ô∏è ‰∏•ÈáçË≠¶Âëä ‚ö†Ô∏è\n\nÊÇ®Ê≠£Âú®ÊâßË°åÊï∞ÊçÆÂ∫ìÊ∏ÖÊ¥óÊìç‰Ωú„ÄÇ\nËøôÂ∞ÜÊ∞∏‰πÖÂà†Èô§ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩï„ÄÅÊàêÂ∞±ÂíåÁªüËÆ°Êï∞ÊçÆ„ÄÇ\n\nÊòØÂê¶ÁªßÁª≠Ôºü")) {
                localStorage.removeItem('cp_logs');
                localStorage.removeItem('cp_achievements');

                // ÂÖ≥ÈîÆÔºöÂêåÊó∂Âà∑Êñ∞‰∏§‰∏™ËßÜÂõæ
                renderStats();
                renderAchievements();

                alert(">> Á≥ªÁªüÊ†ºÂºèÂåñÂÆåÊàê„ÄÇ\n>> ÊâÄÊúâÊï∞ÊçÆÂ∑≤Ê∏ÖÈô§„ÄÇ");
            }
        }

        function saveRecord(task, duration, rating, success, failReason = '') {
            const records = JSON.parse(localStorage.getItem('cp_logs') || '[]');
            const now = new Date();
            const record = {
                date: now.toISOString(),
                dayStr: now.toISOString().split('T')[0],
                task, duration: Math.floor(duration), rating, success, failReason,
                interrupted: appState.hasPausedInSession
            };
            records.push(record);
            localStorage.setItem('cp_logs', JSON.stringify(records));

            checkAchievements(records);
        }

        function checkAchievements(records) {
            let unlocked = JSON.parse(localStorage.getItem('cp_achievements') || '[]');
            const totalMinutes = records.filter(r => r.success).reduce((acc, cur) => acc + cur.duration, 0);

            if (totalMinutes >= 60 && !unlocked.includes('rookie')) unlocked.push('rookie');
            if (totalMinutes >= 900 && !unlocked.includes('thinker')) unlocked.push('thinker');
            if (records.some(r => r.success && r.interrupted) && !unlocked.includes('resilient')) unlocked.push('resilient');

            const last10 = records.filter(r => r.success).slice(-10);
            if (last10.length >= 10) {
                const avg = last10.reduce((a, b) => a + b.rating, 0) / 10;
                if (avg >= 4 && !unlocked.includes('highroller')) unlocked.push('highroller');
            }

            const uniqueDays = [...new Set(records.filter(r => r.success).map(r => r.dayStr))].sort();
            let streak = 0;
            for (let i = 0; i < uniqueDays.length - 1; i++) {
                const d1 = new Date(uniqueDays[i]);
                const d2 = new Date(uniqueDays[i + 1]);
                const diffTime = Math.abs(d2 - d1);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays === 1) streak++; else streak = 0;
                if (streak >= 6 && !unlocked.includes('durable')) { unlocked.push('durable'); break; }
            }

            localStorage.setItem('cp_achievements', JSON.stringify(unlocked));
            renderAchievements();
        }

        function renderAchievements() {
            const list = JSON.parse(localStorage.getItem('cp_achievements') || '[]');
            const container = document.getElementById('ach-container');
            const descBox = document.getElementById('ach-desc');
            container.innerHTML = '';

            Object.keys(ACH_DEFS).forEach(key => {
                const div = document.createElement('div');
                div.className = 'ach-badge ' + (list.includes(key) ? 'unlocked' : '');
                div.innerText = ACH_DEFS[key].icon;

                div.onmouseenter = () => {
                    descBox.innerText = ACH_DEFS[key].title;
                    descBox.style.color = list.includes(key) ? 'var(--cp-green)' : 'var(--cp-blue)';
                };
                div.onmouseleave = () => {
                    descBox.innerText = "HOVER ICON FOR DETAILS";
                    descBox.style.color = "var(--cp-blue)";
                };

                container.appendChild(div);
            });
        }

        function checkHealth() {
            const records = JSON.parse(localStorage.getItem('cp_logs') || '[]');
            const todayStr = new Date().toISOString().split('T')[0];
            const todayMins = records.filter(r => r.dayStr === todayStr && r.success).reduce((a, b) => a + b.duration, 0);

            if (todayMins >= 180 && todayMins < 180 + config.work) {
                alert("‚ö†Ô∏è Ë≠¶ÂëäÔºöÁ™ÅËß¶ÂéãÂäõËøáÂ§ß \n‰ªäÊó•Â∑≤Êé•ÂÖ•Ë∂Ö3Â∞èÊó∂„ÄÇÂª∫ËÆÆÊñ≠ÂºÄËøûÊé•ÔºåÂâçÂæÄÂ§ú‰πãÂüéËøõË°åËÇâ‰ΩìÊ¥ªÂä®„ÄÇ");
            }
        }

        // ==========================================
        // 6. UTILS & VISUALS
        // ==========================================
        function updateTimerDisplay() {
            const m = Math.floor(appState.timeLeft / 60).toString().padStart(2, '0');
            const s = (appState.timeLeft % 60).toString().padStart(2, '0');
            const str = `${m}:${s}`;
            document.getElementById('timer').innerText = str;

            // ÂÖ≥ÈîÆ‰øÆÂ§çÔºöÊó∂Èó¥ÂßãÁªàÂú®ÂâçÔºåÁ°Æ‰øùÂç≥‰ΩøÊ†áÁ≠æÈ°µÂæàÂ∞è‰πüËÉΩÁúãÂà∞Êó∂Èó¥
            if (appState.active && !appState.paused) {
                document.title = `${str} | ACTIVE`;
            } else if (!appState.active) {
                document.title = `${str} | READY`;
            }
        }

        function updateProgressBar() {
            const percent = ((appState.totalTime - appState.timeLeft) / appState.totalTime) * 100;
            document.getElementById('progress-bar').style.width = percent + '%';
        }

        function formatTime(sec) {
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function playBeep() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(440, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        }

        function loadBackground(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => document.getElementById('bg-layer').style.backgroundImage = `url(${e.target.result})`;
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ==========================================
        // Y. BACKGROUND SWITCHER (Êñ∞Â¢ûÊ®°Âùó)
        // ==========================================
        function switchBackground(element) {
            // 1. Ëé∑ÂèñÁÇπÂáªÊåâÈíÆ‰∏äËÆ∞ÂΩïÁöÑÂõæÁâáË∑ØÂæÑ (data-src Â±ûÊÄß)
            const newBgSrc = element.getAttribute('data-src');

            // 2. ËÆæÁΩÆÁªôËÉåÊôØÂ±Ç
            // ‰ΩøÁî®Á∫øÊÄßÊ∏êÂèòÂè†Âä†ÔºåÁ°Æ‰øùÂõæÁâá‰∏ç‰ºöÂ§™‰∫ÆÔºå‰øùÊåÅÊñáÂ≠óÂèØËØªÊÄßÔºàÂª∂Áª≠‰∫Ü‰Ω†ÂéüÊúâÁöÑÈ£éÊ†ºÔºâ
            // Â¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅÂéüÂõæÊõ¥‰∫Æ‰∏ÄÁÇπÔºåÂèØ‰ª•Ë∞ÉÊï¥ËøôÈáåÁöÑ rgba ÂÄº
            document.getElementById('bg-layer').style.backgroundImage = `url('${newBgSrc}')`;

            // 3. Êõ¥Êñ∞ËßÜËßâÁä∂ÊÄÅÔºàÈ´ò‰∫ÆÈÄâ‰∏≠ÁöÑÁº©Áï•ÂõæÔºâ
            // ÂÖàÁßªÈô§ÊâÄÊúâÁº©Áï•ÂõæÁöÑÈ´ò‰∫Æ
            document.querySelectorAll('.bg-thumb').forEach(btn => {
                btn.classList.remove('active-bg');
            });
            // ÂÜçÁªôËá™Â∑±Âä†‰∏äÈ´ò‰∫Æ
            element.classList.add('active-bg');
        }

        // ‰øÆÊîπÂéüÊúâÁöÑ loadBackground ÂáΩÊï∞ÔºåÂä†‰∏ä‰∏ÄÁÇπÁÇπÁªÜËäÇ
        const originalLoadBackground = loadBackground; // ‰øùÂ≠òÂéüÂáΩÊï∞ÂºïÁî®
        loadBackground = function (input) {
            // Ë∞ÉÁî®ÂéüÊúâÁöÑ‰∏ä‰º†ÈÄªËæë
            originalLoadBackground(input);

            // Êñ∞Â¢ûÔºö‰∏ä‰º†Ëá™ÂÆö‰πâÂõæÁâáÂêéÔºåÂèñÊ∂àÊâÄÊúâÂÜÖÁΩÆÁº©Áï•ÂõæÁöÑÈ´ò‰∫ÆÁä∂ÊÄÅÔºåÂõ†‰∏∫Áé∞Âú®Áî®ÁöÑÊòØËá™ÂÆö‰πâÁöÑ
            if (input.files && input.files[0]) {
                document.querySelectorAll('.bg-thumb').forEach(btn => {
                    btn.classList.remove('active-bg');
                });
            }
        }

        function loadMusic(input) {
            if (input.files && input.files[0]) {
                const url = URL.createObjectURL(input.files[0]);
                document.getElementById('bgm-player').src = url;
                alert("BGM Â∑≤Âä†ËΩΩ");
            }
        }

        function setRating(v) {
            appState.tempRating = v;
            document.querySelectorAll('.star-btn').forEach(b => {
                b.classList.toggle('active', parseInt(b.dataset.v) <= v);
            });
        }

        function renderStats() {
            const records = JSON.parse(localStorage.getItem('cp_logs') || '[]');
            const todayStr = new Date().toISOString().split('T')[0];

            const todayMins = records.filter(r => r.dayStr === todayStr && r.success).reduce((a, b) => a + b.duration, 0);
            document.getElementById('today-total').innerText = todayMins + " MIN";

            const listEl = document.getElementById('task-list');
            listEl.innerHTML = '';
            records.slice().reverse().slice(0, 20).forEach(r => {
                const color = r.success ? 'var(--cp-blue)' : 'var(--cp-red)';
                const ratingStr = r.success ? "‚òÖ".repeat(r.rating) : "Â§±Ë¥•";
                const txt = `<span>${r.task}</span> <span style="color:${color}">${ratingStr}</span>`;

                const div = document.createElement('div');
                div.style.borderBottom = "1px solid #222"; div.style.padding = "6px 0";
                div.style.display = "flex"; div.style.justifyContent = "space-between";
                div.style.color = "#ccc";
                div.innerHTML = txt;
                listEl.appendChild(div);
            });

            setTimeout(() => drawChart(records), 50);
        }

        function drawChart(records) {
            const canvas = document.getElementById('trendChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const w = canvas.width = canvas.offsetWidth;
            const h = canvas.height = canvas.offsetHeight;

            ctx.clearRect(0, 0, w, h);

            ctx.strokeStyle = "rgba(0, 240, 255, 0.1)";
            ctx.lineWidth = 1;
            ctx.beginPath();
            for (let i = 1; i < 5; i++) {
                let y = i * (h / 5);
                ctx.moveTo(0, y); ctx.lineTo(w, y);
            }
            ctx.stroke();

            const data = records.filter(r => r.success).slice(-10).map(r => r.rating);
            if (data.length === 0) return;

            ctx.strokeStyle = "#fcee0a";
            ctx.lineWidth = 2;
            ctx.beginPath();

            if (data.length === 1) {
                const y = h - (data[0] / 5.5 * h) - 5;
                ctx.moveTo(0, y); ctx.lineTo(w, y);
            } else {
                const step = w / (data.length - 1);
                data.forEach((v, i) => {
                    const x = i * step;
                    const y = h - (v / 5.5 * h) - 5;
                    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                });
            }
            ctx.stroke();

            ctx.lineTo(w, h);
            ctx.lineTo(0, h);
            ctx.fillStyle = "rgba(252, 238, 10, 0.1)";
            ctx.fill();
        }

        function togglePanel(id) {
            const target = document.getElementById(id + '-panel');
            const isActive = target.classList.contains('active');
            const btn = document.getElementById('btn-' + id);

            closeAllPanels();

            if (!isActive) {
                target.classList.add('active');
                if (btn) btn.classList.add('active-btn');
                if (id === 'stats') renderStats();
            }
        }

        function closeAllPanels() {
            document.querySelectorAll('.slide-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-btn'));
        }

        function saveSettings() {
            config.work = parseInt(document.getElementById('cfg-work').value) || 25;
            config.break = parseInt(document.getElementById('cfg-break').value) || 5;
            localStorage.setItem('cp_config', JSON.stringify(config));
            closeAllPanels();
            if (!appState.active) resetUI();
        }

        // ==========================================
        // X. RADIO SYSTEM 
        const STATIONS = [
            { name: "ACID RAIN", src: "./music/rain.m4a" },      // Èõ®Â£∞
            { name: "MIDNIGHT JAZZ", src: "./music/jazz.m4a" },   // ÁàµÂ£´
            { name: "NEON SYNTH", src: "./music/synth.m4a" },     // Synthwave
            { name: "STREET HIPHOP", src: "./music/hiphop.m4a" },  // Hiphop
            { name: "STATIC NOISE", src: "./music/white.m4a" }     // ÁôΩÂô™Èü≥
        ];

        let radioPlayer = new Audio();
        radioPlayer.loop = true; // ÁîµÂè∞Âæ™ÁéØÊí≠Êîæ
        let currentStationIndex = -1;

        function switchStation(index) {
            // 1. Êõ¥Êñ∞ËßÜËßâÁä∂ÊÄÅ
            const btns = document.querySelectorAll('.station-btn');
            btns.forEach((btn, i) => {
                if (i === index) btn.classList.add('active-station');
                else btn.classList.remove('active-station');
            });

            // 2. Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂêå‰∏Ä‰∏™Ôºå‰∏çÂÅöÂä®‰ΩúÔºàÊàñËÄÖ‰Ω†ÂèØ‰ª•ÈÄâÊã©ÊöÇÂÅúÔºåËøôÈáåËÆæ‰∏∫‰∏çÂÅöÂä®‰ΩúÔºâ
            if (currentStationIndex === index && !radioPlayer.paused) return;

            // 3. ÂàáÊç¢Èü≥È¢ë
            currentStationIndex = index;
            const station = STATIONS[index];

            // Â¶ÇÊûúÁî®Êà∑‰∏ä‰º†‰∫ÜBGMÔºå‰∏∫‰∫ÜÈò≤Ê≠¢ÂêµÊùÇÔºåÂèØ‰ª•ÈÄâÊã©ÊöÇÂÅúÂéüÊúâÁöÑBGMÔºàÂèØÈÄâÔºâ
            // document.getElementById('bgm-player').pause(); 

            radioPlayer.src = station.src;
            radioPlayer.play().then(() => {
                updateRadioStatus(`RECEIVING: ${station.name}`, true);
                const cutBtn = document.getElementById("cut-signal-btn");
                if (cutBtn) {
                    cutBtn.style.background = "var(--cp-yellow)";
                    cutBtn.style.color = "black";
                    cutBtn.style.boxShadow = "0 0 10px var(--cp-yellow)";
                }
            }).catch(e => {
                console.error("Êó†Ê≥ïÊí≠ÊîæÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ë∑ØÂæÑ", e);
                updateRadioStatus("SIGNAL LOST (NO FILE)", false);
            });
        }

        function stopRadio() {
            radioPlayer.pause();
            radioPlayer.currentTime = 0;
            currentStationIndex = -1;

            document.querySelectorAll('.station-btn').forEach(b => b.classList.remove('active-station'));
            updateRadioStatus("OFFLINE", false);
            const cutBtn = document.getElementById("cut-signal-btn");
            if (cutBtn) {
                cutBtn.style.background = "#333";
                cutBtn.style.color = "#888";
                cutBtn.style.boxShadow = "none";
            }
        }

        function setRadioVolume(val) {
            radioPlayer.volume = val / 100;
        }

        function updateRadioStatus(text, isActive) {
            const el = document.getElementById('radio-status');
            el.innerText = text;
            el.style.color = isActive ? "var(--cp-yellow)" : "var(--cp-green)";
            el.style.textShadow = isActive ? "0 0 5px var(--cp-yellow)" : "none";
        }

        // ==========================================
        // THREE.JS PARTICLES
        // ==========================================
        function initThree() {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.z = 1000;
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            const geo = new THREE.BufferGeometry();
            const pos = []; const col = [];
            const pal = [new THREE.Color('#fcee0a'), new THREE.Color('#00f0ff'), new THREE.Color('#ff003c')];

            for (let i = 0; i < 1000; i++) {
                pos.push(Math.random() * 2000 - 1000, Math.random() * 2000 - 1000, Math.random() * 2000 - 1000);
                const c = pal[Math.floor(Math.random() * 3)];
                col.push(c.r, c.g, c.b);
            }
            geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            geo.setAttribute('color', new THREE.Float32BufferAttribute(col, 3));
            const mat = new THREE.PointsMaterial({ size: 3, vertexColors: true, transparent: true, opacity: 0.6 });
            const parts = new THREE.Points(geo, mat);
            scene.add(parts);

            function anim() {
                requestAnimationFrame(anim);
                parts.rotation.y += 0.0005;
                renderer.render(scene, camera);
            }
            anim();
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
</body>

</html>